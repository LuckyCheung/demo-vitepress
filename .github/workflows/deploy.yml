name: deploy-pages

on:
  # ä½¿ç”¨ `master` åˆ†æ”¯ä½œä¸ºé»˜è®¤åˆ†æ”¯ï¼Œè¯·å°†å…¶æ›´æ”¹ä¸º `master`
  push:
    branches:
      - master
    # tags: # å½“æˆ‘ä»¬æäº¤ä»£ç ä¸ºtag æ˜¯ä»¥'v'å¼€å¤´çš„æ—¶å€™æ‰ä¼šè§¦å‘è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡ç«¯ å¦‚ git push tag v0.1.0
    #   - "v*"

  # å…è®¸ä½ ä» Actions é€‰é¡¹å¡æ‰‹åŠ¨è¿è¡Œæ­¤å·¥ä½œæµç¨‹
  workflow_dispatch:

# è®¾ç½® GITHUB_TOKEN çš„æƒé™ï¼Œä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: write
  pages: write
  id-token: write

# åªå…è®¸åŒæ—¶è¿›è¡Œä¸€æ¬¡éƒ¨ç½²ï¼Œè·³è¿‡æ­£åœ¨è¿è¡Œå’Œæœ€æ–°é˜Ÿåˆ—ä¹‹é—´çš„è¿è¡Œé˜Ÿåˆ—
# ä½†æ˜¯ï¼Œä¸è¦å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¿è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å…è®¸è¿™äº›ç”Ÿäº§éƒ¨ç½²å®Œæˆ
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # æ„å»ºå·¥ä½œ
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Branch
        uses: actions/checkout@v4

      - name: Install Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install Dependencies
        run: npm i

      - name: Build
        run: npm run docs:build

      - name: Deploy Github
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: docs/.vitepress/dist

      - name: ğŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.HOST }}
          username: root
          password: ${{ secrets.PASSWORD }}
          local-dir: "docs/.vitepress/dist"
          server-dir: ${{ secrets.DIR }}
